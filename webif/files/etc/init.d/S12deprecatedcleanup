#!/bin/sh

######################################################################
# DeprecateFile
#
# to support squashfs filesystems with symlink hack, we can't just
# delete these if they exist on /rom, else they will re-appear.
DeprecateFile ()
{
	if [ -f "$1" ]; then
		echo " " > "$1"	  
	else
		rm "$1"
	fi
}

######################################################################
# entry
#
# replaced at build time with revision number
this_revision=__SVN_REVISION__
last_cleaned=$(nvram get webif_rev)
if [ "$this_revision" = "$last_cleaned" ]; then
	exit 0
fi

# merged into wan-lan.sh
DeprecateFile "/www/cgi-bin/webif/wan.sh"
DeprecateFile "/www/cgi-bin/webif/lan.sh"
# old name for like 2 builds
DeprecateFile "/www/cgi-bin/webif/wan_lan.sh"
# merged into info.sh
DeprecateFile "/www/cgi-bin/webif/hardwarestats.sh"

#
# early alpha versions of the x-wrt webif qos-config.sh would create a 'dummy'
# /etc/qos.conf if Rudy's QoS scripts weren't installed.
#
if [ -f "/etc/qos.conf" ]; then
	ipkg list_installed | grep qos-re 2>&1 > /dev/null
	if [ $? != 0 ]; then
 		echo " $0: cleaning up unused /etc/qos.conf"
		DeprecateFile "/etc/qos.conf"
	fi	
fi

# I really hate to do this, but seems have to..
nvram set "webif_rev=$this_revision"
nvram commit
